# 事务

## 基本操作
- 开启事务，设定事务的开启位置，此指令执行后，后续的所有指令均加入到事务中  
  `multi`  
- 执行事务，设定事务的结束位置，同时执行事务。与multi成对出现，成对使用  
  `exec`  
- 取消事务，将会删除队列中所有指令  
  `discard`  

  > 开启事务后执行的操作会被加入到队列中，exec后所有再队列中的指令会顺序的执行下去，不会被其他指令插队

## 注意事项
- 定义事务过程中，命令格式输入错误（语法错误）  
  如果出现语法错误，事务中所有的命令均不会执行，包括那些语法正确的命令
- 事务执行的过程中，命令执行出现错误  
  能正确运行的命令会被执行，运行错误的命令不会被执行

  > 已经执行完毕的命令对应的数据不会自动回滚，需要程序员手动修正

## 手动进行事务回滚
- 记录操作过程中被影响的数据之前的状态
  - 单数据：string
  - 多数据：hash、list、set、zset
- 设置指令恢复所有的被修改的项
  - 单数据：直接set（注意周边属性，如失效）
  - 多数据：修改对应值或者整体克隆复制