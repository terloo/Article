# OCI
OCI，`Open Container Initative(开放容器标准)`是linux基金会主导的开源项目，旨在为容器合适和运行时提供行业标准

## 组成
1. 容器镜像规范：定义了容器运行时所使用的镜像的打包规范
2. 容器运行时规范：定义了如何根据配置来运行一个容器

## 主要概念
1. 操作标准化：对容器整个生命周期内相关操作进行标准化，包括创建、启动、停止、创建快照、暂停、回复等操作。规范了每个操作的原子定义
2. 内容无关：指不管容器具体内容是什么，进行标准化操作后都能得到一个相同的结果
3. 基础设施无关：容器可以运行在任何支持OCI的基础设施上
4. 为自动化而生：由于容器的标准操作与基础设施无关，所以可以全平台自动化
5. 工业级交互：使应用分发达到工业级的交互

## OCI特殊宿主机文件
Linux下的应用程序需要Linux系统提供一些特殊的文件系统，runc规定了以下文件需要由宿主机进行挂载
1. /proc：挂载proc文件系统
2. /sys：挂载sysfs文件系统
3. /dev/pts：挂载devpts文件系统
4. /dev/shm：挂载tmpfs文件系统
5. /dev：挂载tmpfs文件系统
6. /dev/mqueue：挂载mqueue文件系统

## OCI容器运行时规范
容器的基本配置应该包括一下几个状态
1. ociVersion：oci规范的版本信息
2. id：容器的id，在同一主机上必须唯一，对于不同的主机，不做强制性要求
3. status：容器的运行状态
   1. creating：创建中
   2. created：容器进程未退出，而用户的应用程序还未执行
   3. running：容器进程已退出，用户的应用程序正常执行中
   4. stopped：容器进程已退出
4. pid：容器进程id
5. bundle：容器标准包的绝对路径。包含了容器运行时配置和rootfs
6. annotations：容器自定义的属性

## 钩子点
1. prestart：只能在运行时调用，如果调用失败需要清除容器进程。会在start命令执行后，但仍未启动用户应用程序时调用。对于linux，会在创建完namespace后调用
2. poststart：启动完用户应用程序但start命令还未返回时调用
3. poststop：容器被删除但删除命令还未返回时调用

## 容器标准包 Bundle
Bundle包含了容器运行所需的所有环境，是容器一致性的基础保证
1. config.json：容器运行时配置内容
2. root filesystem：容器运行使用的rootfs

## Image规范
1. mainfest：对于指定了架构和OS的容器镜像，manifest定义了它所依赖的相关信息配置和对应layer层信息
2. image index：比manifest更高层次的抽象，包含了额外的配置信息
3. filesystem layer：给出了如何将容器的文件系统进行序列化，如何创建和使用这些layer