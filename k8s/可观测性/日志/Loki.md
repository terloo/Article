# Loki
Loki是Grafana开源的功能的齐全的日志记录一组组件

## 特点
1. Loki基于仅索引有关日志元数据：标签
2. 日志数据本身被压缩并存储在对象存储(例如S3或GCS)中的块中，甚至存储在文件系统本地
3. 小索引和高度压缩的块简化了操作，并大大降低了Loki的成本

## Loki-stack子系统
1. Promtail
   1. 将容器日志发送到Loki或者Grafana服务上的日志收集工具
   2. 发现采集目标以及给日志流添加上Label，然后发送给Loki
   3. Promtail的服务发现是基于Prometheus的服务发现机制实现的
2. Loki
   1. Loki是可以水平扩展的、高可用以及支持多租户的日志聚合系统
   2. 使用和Prometheus的服务发现机制，将标签添加到日志流中而不是构建全文索引
   3. Promtail接收到的日志和应用的metrics指标具有相同的标签集
3. Grafana
   1. 用于展示Prometheus和Loki等数据源的时间序列数据
   2. 允许查询、可视化、报警等操作，可用于创建、探索和共享数据DashBoard

## Loki组件
1. Distributor(分配器)
   1. 分配器处理客户端写入的日志
   2. 一旦分配器接收到日志数据，它就会把它们分成若干批次，并将它们并行地发送到多个采集器去
   3. 分配器通过gRPC和采集器进行通信
   4. 无状态，基于一致性哈希，可以根据需要进行扩缩容
2. Ingester(采集器)
   1. 采集器服务负责将日志数据写入长期存储的后端(DynamoDB、S3、Cassandra)
   2. 采集器会校验采集的日志是否乱序
   3. 采集器验证接收到的日志行是按照时间戳递增的顺序接收的，否则日志行将会被拒绝并返回错误
3. Querier(查询器)
   1. 查询服务负责处理LogQL查询语句来评估存储在长期存储中的日志数据