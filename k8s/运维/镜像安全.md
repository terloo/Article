# 镜像安全

## 最佳实践
1. 构建指令问题：避免在构建镜像时，添加密钥，Token等敏感信息(配置与代码分离)
2. 应用依赖问题：
   1. 尽量安装不必要的依赖
   2. 确保依赖无安全风险，一些长时间不更新的基础镜像可能面临安全风险
3. 文件问题
   1. 在构建镜像时，除了应用本身外，还会添加应用需要的配置文件、模板等。在添加这些文件时，会无意添加一些敏感信息或不符合安全策略的文件到镜像中
   2. 当镜像出现问题时，需要通过引入该文件的构建指令进行修复，而不是通过追加一条删除指令来修复

## 镜像扫描(Vulnerability Scanning)
镜像扫描通过扫描工具或扫描服务对镜像进行扫描，来确定镜像是否安全
1. 分析构建指令、应用、文件、依赖包
2. 查询CVE库、安全策略
3. 检测镜像是否安全，是否符合企业的安全标准

## 镜像准入策略控制
镜像准入控制是在部署Pod，更新Pod时，对Pod中所有镜像进行安全验证以放行或拦截对Pod的操作
1. 放行：Pod的所有镜像都安全，允许此次Pod新建操作，Pod被成功新建或者更新
2. 拦截：Pod的镜像未扫描或者已扫描但存在安全漏洞，或不符合安全策略，Pod无法被创建或者更新

## 扫描镜像
1. 镜像扫描服务从镜像仓库拉取镜像
2. 解析镜像的元数据
3. 解压镜像的每一个文件层
4. 提取每一层包含的依赖包、可运行文件、文件列表、文件内容扫描
5. 将扫描结果与CVE字段、安全策略字典进行匹配，以确认镜像最终是否安全

## 常用镜像扫描软件
1. anchore
2. chair