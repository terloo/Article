# IP协议

## 报文格式
1. 首部
   1. 固定部分 20B
      1. 版本 0.5B
      2. 首部长度，单位为4B，范围5-15 0.5B
      3. 区分服务，未启用 1B
      4. 总长度，首部加数据之和 2B
      5. 标识，在被以太网分割为多个帧之后，用于标识哪些帧属于同一个IP报文 2B
      6. 标志，从低位到高位，MF表示后面是否还有分片，DF表示是否允许分片  3bit
      7. 片偏移，分片后的数据在源数据中的偏移量，单位为8B   13bit
      8. 生存时间，剩余跳转次数，每次被路由器转发前-1，如果为0，报文被丢弃 1B
      9. 协议，高层协议 1B
      10. 首部校验和，只校验首部  2B
      11. 源地址  4B
      12. 目的地址 4B
      13. 可选长度
      14. 填充，保证首部是4B的整数长度
   2. 可变部分
2. 数据部分

## IP地址
IP由32位二进制地址构成，分为网络位和主机位，主机位的位数决定可以容纳的主机
1. A类：0NNNNNNN HOST HOST HOST
2. B类：10NNNNNN NETWORK HOST HOST
3. C类：110NNNNN NETWORK NETWORK HOST
4. D类：1110MMMM MulticastGroup MulticastGroup MulticastGroup
5. E类：保留
> ABC类为单播地址，D类为多播(组播)地址

## 公有私有地址
每类单播地址又分为公有地址或私有地址
1. 公有地址：由因特网信息中心进行分配
2. 私有地址：非注册地址，由机构内部进行使用，使用NAT技术访问公有地址
| 类别 | 地址范围                      | 网络号                  | 网络数 | 网络位 | 子网掩码 |
| ---- | ----------------------------- | ----------------------- | ------ | ------ | -------- |
| A    | 10.0.0.0 ~ 10.255.255.255     | 10                      | 1      | 0x10   | /8       |
| B    | 172.16.0.0 ~ 172.31.255.255   | 172.16 ~ 172.31         | 16     | 0xAC1  | /16      |
| C    | 192.168.0.0 ~ 192.168.255.255 | 192.168.0 ~ 192.168.255 | 256    | 0xC0A8 | /24      |

## 特殊IP地址
| 网络号  | 主机号         | 源地址使用 | 目的地址使用 | 意义                                 |
| ------- | -------------- | ---------- | ------------ | ------------------------------------ |
| 0       | 0              | 可以       | 不可         | 在本网络上的本主机(临时使用)         |
| 全1     | 全1            | 不可       | 可以         | 本地受限广播地址，在本网络上进行广播 |
| Net-ID  | 全1            | 不可       | 可以         | 对net-id上的所有地址进行广播         |
| 127     | 非全0或全1的数 | 可以       | 可以         | 用作软件本地回环测试使用             |
| 169.254 | 非全0或全1的数 | 可以       | 可以         | windows主机DHCP服务器故障分配        |

## 子网划分
从主机号中借用n位作为子网号，这个特性称为子网划分。划分的子网数=2^n，可以容纳2^(主机位-n)-2个主机

## 子网掩码
子网掩码长度32位，由一连串的1或者0组成，1表示IP地址中的网络位，2表示IP地址中的主机位。可以简写为`IP/n`，n表示1的个数

## CIDR
无分类编址方法(CIDR)，不将IP地址划分为ABCD类，而是将IP地址相同的网络地址块组成“CIDR地址块”，使用`IP/n`的形式表示