# OSPF协议
开放最短路径优先协议，属于链路状态通告协议中的一种

## 工作步骤
1. 通过交互Hello报文形成邻居关系
2. 通过LSA泛洪通告链路状态信息
3. 通过组建LSDB形成带权有向图(整个网络的拓扑结构)
4. 通过SPF算法计算并形成路由
5. 维护和更新路由表

## 点对点或点到多点型网络建立邻居关系
1. 周期性每隔10s发送hello包，发现有邻居，40s没有收到hello包，认为邻居失效。使用组播地址`224.0.0.5`
2. OSPF区域内唯一标识路由器的IP地址
   1. 使用router-id命令指定RouterID
   2. 选取路由器loopback接口上数值最高的IP地址
   3. 如果没有loopback接口，在物理端口中选取IP地址最高的

## 广播型网络或非广播型多路访问网络建立邻居关系
1. 通过Hello报文选择DR和BDR来代表OSPF网段
   1. 先比较优先级(0-255，默认为1)，后比较routeID
   2. 优先级为0的不参与DR和BDR选举
   3. 通过组播发送hello报文
2. 其他路由器只与DR与BDR形成邻居关系
3. DR/BDR监听组播地址`224.0.0.6`，其他路由器监听组播地址`224.0.0.5`

## LSA报文
| 类型代码 | 描述        | 用途                                                 |
| -------- | ----------- | ---------------------------------------------------- |
| Type1    | 路由器LSA   | 由本区域内的路由器发出的                             |
| Type2    | 网络LSA     | 由区域内的DR发出的(广播型网络使用)                   |
| Type3    | 网络汇总LSA | ABR发出的，其他区域的汇总链路通告                    |
| Type4    | ASBR汇总LSA | ABR发出的，用于通告ASBR信息                          |
| Type5    | AS外部LSA   | ASBR发出的，用于通告外部路由                         |
| Type7    | NSSA外部LSA | NSSA区域内的ASBR发布的，用于通告本区域连接的外部路由 |
> Type7报文在经过NSSA的ARB时，会被转为Type5

| 区域类型               | 1&2  | 3      | 4&5    | 7      |
| ---------------------- | ---- | ------ | ------ | ------ |
| 骨干区域(区域0)        | 允许 | 允许   | 允许   | 不允许 |
| 非骨干区域，非末梢区域 | 允许 | 允许   | 允许   | 不允许 |
| 末梢区域               | 允许 | 允许   | 不允许 | 不允许 |
| 完全末梢区域           | 允许 | 不允许 | 不允许 | 不允许 |
| NSSA                   | 允许 | 允许   | 不允许 | 允许   |

## SPF(最短路径优先)算法
SPF与到达目的网络的出接口带宽(开销)相关
1. 默认开销值COST=100/带宽Mbps    带宽越大，开销越小
2. 最短路径是开销值最小的路径

## 路由器类别
| 类型                   | 含义                                                                                                                                    |
| ---------------------- | --------------------------------------------------------------------------------------------------------------------------------------- |
| 区域类路由器           | 该类路由器的所有接口都属于同一个OSPF区域                                                                                                |
| 区域边界路由器ARB      | 该类路由器可以同时属于两个区域，但其中一个必须是骨干区域。ARB用于连接骨干和非骨干区域，它与骨干区域的连接既可以是物理的，也可以是逻辑的 |
| 骨干路由器             | 该类路由器至少有一个接口属于骨干区域。所有的ARB和位于Area0的内部设备都是骨干路由器                                                      |
| 自治系统边界路由器ASBR | 与其他AS交换路由信息的设备称为ASBR，只要一台OSPF设备引入了外部路由信息，它就是ASBR                                                      |

## 区域类型
| 区域类型                                | 作用                                                                        | 说明                                                                                                                |
| --------------------------------------- | --------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------- |
| 普通区域                                | 包括标准区域和骨干区域                                                      |
| Stub(末梢、存根)区域                    | 位于自治系统的边界，只有一个ARB的非骨干区域，不学习外部路由，路由表信息较少 | Stub区域的ARB会发布一条默认路由，供Stub区域路由至外部网络。如果Stub区域被配置为完全Stub区域，则也不会学习区域间路由 |
| NSSA(Not-So-Stubby Area 非完全末梢)区域 | Stub区域的变形，只学习自己引进的外部路由，不学其他外部路由                  |