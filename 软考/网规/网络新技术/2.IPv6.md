# IPv6

## 特性
1. 128的地址空间
2. 更高效的路由基础
   1. 在分配之初就考虑到骨干网汇总的问题
   2. 不再使用IPv4的首部，改为扩展首部
3. 安全性
   1. IPsec在IPv6中是必备的
   2. IPv6通过扩展首部来实现IPsec

## 扩展首部
1. 逐跳选项：定义转发途径中每一个节点应该处理什么信息
2. 路由选择：记录转发途径中路由的信息
3. 分片：用于IPv6报文分片和重组
4. 鉴别：保证完整性，做源点鉴别
5. 封装安全有效荷载
6. 目的站选项：定义目的主机额外信息

## 地址表示方法
1. 基本表示：8组2字节的十六进制数字，每组之间用冒号分割，`ABCD:EF01:2345:6789:ABCD:EF01:2345:6789`
2. 剔除每组数字中的前导0，全0的组可以写为单个0
3. 如果有连续的一组或多组全0，将其省略并写作双冒号，**双冒号只能出现一次**，`fe80::6339:a57a:63f7:e1d4`

## 地址类型
1. 单播
   1. 全球单播地址
      1. Global routing prefix：全球路由前缀。由提供商指定给某一个组织机构，通常路由前缀为48位，目前前三位均为001
      2. Subnet ID：子网ID。组织机构可以用子网ID来构建本地网络，通常为16位
      3. Interface ID：接口标识。用来标识一个设备，通常为64位
         1. 可以由MAC地址生成
         2. 可以随机生成
   2. 链路本地单播地址，当一个节点启动IPv6时，会自动配置一个链路本地单播地址，该地址作为源地址或目的地址时不会进行路由
      1. 前缀为`fe80::/10`(最高10位为1111111010)
      2. 54位0
      3. 64位接口标识，由MAC地址生成
   3. 站点本地单播地址：相当于IPv6中的私有地址，已废弃
      1. 前缀为`fec0::/48`
      2. 16位子网地址
      3. 64位接口地址
   4. 唯一本地IPv6单播地址：用于取代站点本地单播地址
      1. 前缀`fd00::/8`
   5. 特殊地址
      1. 未指定地址`::`：相当于0.0.0.0
      2. 环回地址`::1`：相当于127.0.0.1
   6. 兼容地址：IPv4到IPv6过渡用于地址
      1. IPv4兼容地址：`::w.x.y.z`，无实际应用
      2. IPv4映射地址：`::ffff:w.x.y.z`，无实际应用
      3. 6to4地址：用于在IPv4网络上传输IPv6的包，`2002:WWXX:YYZZ:[SLA ID]:[Interface ID]`
      4. 6over4地址：用于6over4隧道技术的地址，`[64bit-prefix]:0:0:WWXX:YYZZ`
      5. ISATAP地址：用于ISATAP隧道技术的地址，`[64bit-prefix]:0:5EFE:WWXX:YYZZ`
2. 组播：同时实现了广播功能
   1. 任何一个节点能够是一个组播的成员
   2. 一个源节点可以发送数据包到组播组
   3. 组播组的所有成员收到发往该组的数据包
   4. 组播地址在IPv6包中不能作为源地址或出现在任何选路头中
   5. 格式
      1. 前缀`FFFF:FFFF::/8`
      2. flag，4bit
      3. scop，4bit
      4. groupID，112bit
3. 任播：
   1. 标注一组接口，目的地址是任播地址的数据包将发送给其中路由意义上最近的一个网络接口
   2. 通过任播地址，可以给多个主机或节点提供相同服务时提供冗余功能和负载分担功能
   3. 发送者发送任播目的地址的报文时，无法控制哪台设备能接收到此报文，这取决于整个网络中路由协议计算的结果
   4. 目前只分配给路由器，不分配给终端
   5. 格式为接口ID全为0的单播地址

## IPv6过渡技术
1. 双协议栈
2. 隧道技术
3. NAT/PT技术