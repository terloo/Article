# 根元素

## hosts
playbook中的每个play的目的都是为了让特定的主机以某个指定的用户身份执行某个任务。hosts用于指定要执行任务的主机，须事先定义在主机清单中
```
one.example.com
onw.example.com:two.example.com
192.168.1.50
192.168.1.*
webserver:dbserver   # 两个组的并集
webserver:&dbserver  # 两个组的交集
webserver:!appserver # 在webserver组且不在appserver组
```
```yaml
- hosts: webserver:dbserver
```

## remote_user
指定执行任务所使用的用户

## tasks
对一个模块调用称为一个task，各个task按顺序在hosts指定的主机上依次执行。每个task都应该指定其name，如果没有name，则结果将用于输出
```yaml
- hosts: webserver
  remote_user: root  # 默认为root
  tasks:
  - name: install httpd
    yum: name=httpd        # module_name: module_args
  - name: start httpd
    yum: name=httpd state=started enabled=yes
```

### handlers和notify
每个task执行完毕时，可以触发一个信号，称为notify。在playbook中，可以配置handlers，来配置指定信号触发时应执行的操作
```yaml
- hosts: webserver
  remote_user: root
  tasks:
  - name: install httpd
    yum: name=httpd
  - name: install config file
    copy: src=files/httpd.conf dest=/etc/httpd/conf/
    notify: restart httpd                            # 如果成功执行了该task，那么会触发一个名为restart httpd的notify
  - name: start httpd
    service: name=httpd state=started enabled=yes
  handlers:
  - name: restart httpd  # 触发的信号
    service: name=httpd state=restarted  # 触发信号后执行的动作
```

### tags
利用tags标签，可以为特定的task指定标签。在指定playbook时，可以选择性的执行特定的tags，而非整个playbook文件。由tags执行的task也会触发notify
```yaml
- hosts: webserver
  remote_user: root
  tasks:
  - name: install httpd
    yum: name=httpd state=present
  - name: install config file
    copy: src=files/httpd.conf dest=/etc/httpd/conf/
    tags: conf
  - name: start httpd
    service: name=httpd state=started enabled=yes
    tags: service
```
```sh
# 列出所有的标签
ansible-playbook --list-tags
# 利用标签来指定需要执行的task
ansible-playbook -t conf,service playbook.yaml
```

## 变量
变量名格式`[a-z][a-z0-9_]*`，变量定义格式`变量名=变量值`，变量使用格式`{{ 变量名 }}`，有时需要用`"{{ 变量名 }}"`

### 变量来源
1. setup模块中的所有变量(facts变量)，无法在AH-Hoc中使用
2. 通过命令行指定`ansible-playbook -e varname=varvalue`
3. 在playbook文件中进行定义
```yaml
- hosts: webserver
  remote_user: root
  vars:
  - var1: value1
  - var2: value2
```